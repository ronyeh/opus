<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Guitar Chord Synth</title>
  </head>
  <body>
    <h1>Guitar Chord Synth</h1>
    <button id="playButton">Play Open C Major Chord</button>
    <div>
      <input type="checkbox" id="consistentSound" />
      <label for="consistentSound">Use Consistent Sound</label>
    </div>
    <p>
      Click the button to play an open C major chord.
    </p>
    <script src="https://unpkg.com/tone"></script>
    <script>
      // Chord notes for C Major (x32010)
      const chordNotes = ["C3", "E3", "G3", "C4", "E4"];

      // Implementation 1: An array of PluckSynths for polyphony (randomized pluck)
      const pluckSynths = chordNotes.map(() => new Tone.PluckSynth({
        dampening: 5000,
        resonance: 0.98,
      }).toDestination());

      // Implementation 2: A deterministic synth that sounds like a pluck
      const consistentSynth = new Tone.PolySynth(Tone.FMSynth, {
        "harmonicity": 3.01,
        "modulationIndex": 14,
        "envelope": {
          "attack": 0.01,
          "decay": 2,
          "sustain": 0.1,
          "release": 2
        },
        "modulation" : {
          "type" : "square"
        },
        "modulationEnvelope" : {
          "attack": 0.01,
          "decay": 0.5,
          "sustain": 0.2,
          "release": 0.5
        }
      }).toDestination();


      // UI Elements
      const playButton = document.getElementById("playButton");
      const consistentSoundCheckbox = document.getElementById("consistentSound");

      // Event Listener
      playButton.addEventListener("click", async () => {
        await Tone.start();
        console.log("AudioContext started");

        const time = Tone.now();

        if (consistentSoundCheckbox.checked) {
          console.log("Playing C Major with consistent FMSynth");
          consistentSynth.triggerAttackRelease(chordNotes, "2n", time);
        } else {
          console.log("Playing C Major with randomized PluckSynth array");
          pluckSynths.forEach((synth, index) => {
            synth.triggerAttack(chordNotes[index], time);
          });
        }
      });
    </script>
  </body>
</html>

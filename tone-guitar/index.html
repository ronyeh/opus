<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Guitar Synth</title>
  </head>
  <body>
    <h1>Guitar Synth</h1>
    <button id="playButton">Play Middle C</button>
    <div>
      <input type="checkbox" id="consistentSound" />
      <label for="consistentSound">Use Consistent Sound</label>
    </div>
    <p>
      Click the button to play a single note synthesized using the
      Karplus-Strong algorithm with Tone.js.
    </p>
    <script src="https://unpkg.com/tone"></script>
    <script>
      // Implementation 1: PluckSynth (randomized pluck)
      const pluckSynth = new Tone.PluckSynth({
        dampening: 5000,
        resonance: 0.98,
      }).toDestination();

      // Implementation 2: A deterministic synth that sounds like a pluck
      const consistentSynth = new Tone.PolySynth(Tone.FMSynth, {
        "harmonicity": 3.01,
        "modulationIndex": 14,
        "envelope": {
          "attack": 0.01,
          "decay": 2,
          "sustain": 0.1,
          "release": 2
        },
        "modulation" : {
          "type" : "square"
        },
        "modulationEnvelope" : {
          "attack": 0.01,
          "decay": 0.5,
          "sustain": 0.2,
          "release": 0.5
        }
      }).toDestination();


      // UI Elements
      const playButton = document.getElementById("playButton");
      const consistentSoundCheckbox = document.getElementById("consistentSound");

      // Event Listener
      playButton.addEventListener("click", async () => {
        await Tone.start();
        console.log("AudioContext started");

        const note = "C3";
        const time = Tone.now();

        if (consistentSoundCheckbox.checked) {
          console.log("Playing with consistent FMSynth");
          consistentSynth.triggerAttackRelease(note, "2n", time);
        } else {
          console.log("Playing with randomized PluckSynth");
          pluckSynth.triggerAttack(note, time);
        }
      });
    </script>
  </body>
</html>